---
title: Full OAuth Server
sidebarTitle: Full OAuth Server
description: Build a self-contained authentication system where your FastMCP server manages users, issues tokens, and validates them.
icon: server
---

import { VersionBadge } from "/snippets/version-badge.mdx"

<VersionBadge version="2.11.0" />

<Warning>
This is an **advanced pattern**. Most applications should use the [**Remote Authorization**](/servers/auth/remote-authorization) pattern to integrate with a dedicated identity provider. Building a full, secure OAuth server is a significant undertaking.
</Warning>

In the **Full OAuth Server** pattern, your FastMCP server acts as both the **Authorization Server (AS)** and the **Resource Server (RS)**. It is responsible for the entire authentication lifecycle:
-   Registering client applications.
-   Handling user login and consent.
-   Issuing access and refresh tokens.
-   Validating its own tokens to protect its tools and resources.

This pattern is suitable for standalone applications that require their own user management system and do not rely on an external identity provider.

### `InMemoryOAuthProvider` (For Development & Testing)

FastMCP includes `InMemoryOAuthProvider`, a complete, in-memory implementation of the `OAuthProvider` class. It's an excellent tool for understanding the OAuth flow, prototyping, and running tests without needing a database or external dependencies.

Because it's in-memory, all registered clients and issued tokens are lost when the server restarts.

```python
from fastmcp import FastMCP
from fastmcp.server.auth.providers.in_memory import InMemoryOAuthProvider

# The InMemoryOAuthProvider handles all OAuth endpoints and token management.
auth_provider = InMemoryOAuthProvider(
    # The public URL of this FastMCP server.
    base_url="http://localhost:8000"
)

mcp = FastMCP(
    name="Self-Contained Auth Server",
    auth=auth_provider
)

@mcp.tool
def get_secret_message() -> str:
    """A tool protected by our self-hosted OAuth server."""
    return "The eagle flies at midnight."

if __name__ == "__main__":
    mcp.run(transport="http", port=8000)
```

When you run this server, it will expose all the necessary OAuth 2.1 endpoints:
-   `/.well-known/oauth-authorization-server` (Discovery)
-   `/register` (Dynamic Client Registration)
-   `/authorize` (Authorization Endpoint)
-   `/token` (Token Endpoint)

MCP-compliant clients can now perform the full OAuth flow against your FastMCP server.

### Building a Production OAuth Provider

To build a production-ready OAuth server, you would subclass `fastmcp.server.auth.auth.OAuthProvider` and implement its abstract methods to connect to a persistent user and client database.

This would involve implementing logic for:
-   `get_client(client_id)`: Look up a registered client in your database.
-   `register_client(client_info)`: Save a new client's information.
-   `authorize(client, params)`: Handle user login, consent, and generate an authorization code.
-   `exchange_authorization_code(...)`: Exchange an auth code for tokens.
-   `load_refresh_token(...)`: Validate and retrieve a refresh token.
-   `exchange_refresh_token(...)`: Issue new tokens from a refresh token.
-   `load_access_token(...)`: Validate an access token.
-   `revoke_token(...)`: Invalidate a token.

This is a significant undertaking that requires careful consideration of security best practices. For most use cases, using a dedicated identity provider via the **Remote Authorization** pattern is the recommended approach.