---
title: Scalekit ü§ù FastMCP
sidebarTitle: Scalekit
description: Secure your FastMCP server with Scalekit
icon: shield-check
tag: NEW
---

import { VersionBadge } from "/snippets/version-badge.mdx"

<VersionBadge version="2.12.4" />

This guide shows you how to secure your FastMCP server using [**Scalekit**](https://scalekit.com), an enterprise-grade authentication and user management platform. This integration uses the [**Remote OAuth**](/servers/auth/remote-oauth) pattern, where Scalekit handles user authentication and your FastMCP server validates the tokens.

## Configuration

### Prerequisites

Before you begin, you will need:

1. A [Scalekit account](https://app.scalekit.com/)
2. Your **Environment URL** and **Client ID** from the Scalekit Dashboard (e.g., `https://your-env.scalekit.com`)
4. A configured **MCP Server** with Resource ID
5. Your FastMCP server's URL (can be localhost for development, e.g., `http://localhost:3000`)

### Step 1: Configure Scalekit

<Steps>
<Step title="Register Resource Server">
    1. In the Scalekit Dashboard, navigate to **MCP Servers**
    2. Register your MCP Server with appropriate scopes
    3. Ensure that the Resource Identifier configured in Scalekit Dashboard matches exactly as your MCP Server Base URL
    4. Note the **Resource ID**

    <Warning>
    The Resource ID is required for FastMCP to validate tokens against the correct resource server.
    </Warning>
</Step>
</Steps>

### Step 2: Environment Setup

Create a `.env` file with your Scalekit configuration:

```bash
SCALEKIT_ENVIRONMENT_URL=https://your-env.scalekit.com  # Your Scalekit environment URL
SCALEKIT_CLIENT_ID=skc_client_123                       # Your OAuth client ID
SCALEKIT_RESOURCE_ID=res_21212122222                   # Your resource server ID
SERVER_URL=http://localhost:3000                       # Your server's base URL
```

<Note>
Replace the example values with your actual Scalekit configuration from the Scalekit Dashboard.
</Note>

### Step 3: FastMCP Configuration

Create your FastMCP server file and use the ScalekitProvider to handle all the OAuth integration automatically:

```python server.py
from fastmcp import FastMCP
from fastmcp.server.auth.providers.scalekit import ScalekitProvider

# The ScalekitProvider automatically discovers Scalekit endpoints
# and configures JWT token validation
auth_provider = ScalekitProvider(
    environment_url=SCALEKIT_ENVIRONMENT_URL,    # Your Scalekit environment URL
    client_id=SCALEKIT_CLIENT_ID,                # Your OAuth client ID
    resource_id=SCALEKIT_RESOURCE_ID,            # Your resource server ID
    base_url=SERVER_URL,                         # Your server's public URL (used as audience)
)

# Create FastMCP server with auth
mcp = FastMCP(name="My Scalekit Protected Server", auth=auth_provider)

@mcp.tool
def get_user_profile() -> dict:
    """Get authenticated user profile information."""
    return {"message": "This tool requires Scalekit authentication"}

```

## Testing

To test your server, you can use the `fastmcp` CLI to run it locally. Assuming you've saved the above code to `server.py` (after replacing the configuration values with your actual Scalekit settings!), you can run the following command:

```bash
fastmcp run server.py --transport http --port 8000
```

Now, you can use a FastMCP client to test that you can reach your server after authenticating:

```python
from fastmcp import Client
import asyncio

async def main():
    async with Client("http://localhost:8000/mcp/", auth="oauth") as client:
        assert await client.ping()
        print("Successfully authenticated with Scalekit!")

        # Call protected tools
        tools = await client.list_tools()
        print(f"Available tools: {[tool.name for tool in tools]}")

if __name__ == "__main__":
    asyncio.run(main())
```

## Environment Variables

For production deployments, use environment variables instead of hardcoding credentials.

### Provider Selection

Setting this environment variable allows the Scalekit provider to be used automatically without explicitly instantiating it in code.

<Card>
<ParamField path="FASTMCP_SERVER_AUTH" default="Not set">
Set to `fastmcp.server.auth.providers.scalekit.ScalekitProvider` to use Scalekit authentication.
</ParamField>
</Card>

### Scalekit-Specific Configuration

These environment variables provide default values for the Scalekit provider, whether it's instantiated manually or configured via `FASTMCP_SERVER_AUTH`.

<Card>
<ParamField path="FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_ENVIRONMENT_URL" required>
Your Scalekit environment URL from the Admin Portal (e.g., `https://your-env.scalekit.com`)
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_CLIENT_ID" required>
Your Scalekit OAuth application client ID from the Applications section
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_RESOURCE_ID" required>
Your Scalekit resource server ID from the Resources section
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_BASE_URL" required>
Public URL of your FastMCP server (e.g., `https://your-server.com` or `http://localhost:8000` for development)
</ParamField>
</Card>

Example `.env` file:

```bash
# Use the Scalekit provider
FASTMCP_SERVER_AUTH=fastmcp.server.auth.providers.scalekit.ScalekitProvider

# Scalekit configuration
FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_ENVIRONMENT_URL=https://your-env.scalekit.com
FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_CLIENT_ID=sk_client_123
FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_RESOURCE_ID=sk_resource_456
FASTMCP_SERVER_AUTH_SCALEKITPROVIDER_BASE_URL=https://your-server.com
```

With environment variables set, your server code simplifies to:

```python server.py
from fastmcp import FastMCP

# Authentication is automatically configured from environment
mcp = FastMCP(name="My Scalekit Protected Server")

@mcp.tool
def protected_action() -> str:
    """A tool that requires authentication."""
    return "Access granted via Scalekit!"
```

## Features

### OAuth 2.1 with Dynamic Client Registration

Scalekit provides full OAuth 2.1 support with Dynamic Client Registration (DCR), enabling:

- **Automatic Client Registration**: MCP clients can register themselves without manual configuration
- **PKCE Security**: Proof Key for Code Exchange for enhanced security in authorization flows
- **Seamless Authentication**: No need for pre-configured client credentials or manual app setup
- **Modern Standards**: Full compliance with OAuth 2.1 and OpenID Connect specifications

This DCR support is what enables Scalekit to work with the [**Remote OAuth**](/servers/auth/remote-oauth) pattern, providing the smoothest possible authentication experience for MCP clients.

### Enterprise SSO Support

Scalekit supports various enterprise SSO providers out of the box:

- SAML 2.0
- OpenID Connect (OIDC)
- OAuth 2.0
- Active Directory Federation Services (ADFS)
- Azure AD
- Google Workspace
- And many more

### JWT Token Validation

The ScalekitProvider automatically:

- Fetches Scalekit's public keys for token verification
- Validates token signatures using RS256
- Checks token issuer and audience claims
- Handles token expiration

### Security Best Practices

- Tokens are validated using Scalekit's public keys
- All communication uses HTTPS in production
- Token scopes and claims can be inspected and validated
- Authentication logs available in Scalekit Dashboard

## Troubleshooting

### Common Issues

1. **"Invalid client" error**: Verify `SCALEKIT_CLIENT_ID` and `SCALEKIT_RESOURCE_ID` match your Scalekit configuration
2. **"Token validation failed"**: Check that `SCALEKIT_ENVIRONMENT_URL` is correct and accessible
3. **"Redirect URI mismatch"**: Ensure redirect URLs in your OAuth app match your client configuration
4. **"Audience validation failed"**: Verify `SERVER_BASE_URL` matches the URL clients use to access your server

### Debug Mode

Enable detailed logging to troubleshoot authentication issues:

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### Token Inspection

You can inspect JWT tokens in your tools to understand the user context:

```python
from fastmcp.server.context import request_ctx
import jwt

@mcp.tool
def inspect_token() -> dict:
    """Inspect the current JWT token claims."""
    context = request_ctx.get()

    # Extract token from Authorization header
    if hasattr(context, 'request') and hasattr(context.request, 'headers'):
        auth_header = context.request.headers.get('authorization', '')
        if auth_header.startswith('Bearer '):
            token = auth_header[7:]
            # Decode without verification (already verified by provider)
            claims = jwt.decode(token, options={"verify_signature": False})
            return claims

    return {"error": "No token found"}
```
